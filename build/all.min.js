/*
 * The MIT License
 *
 * (MIT)Copyright (c) 2015 artjomb
 */
!function(a,b){"function"==typeof define&&define.amd?define(["crypto-js/core"],b):b(a.CryptoJS)}(this,function(a){function b(a,b,c){for(var d=this,e=d._cipher,f=e.blockSize,g=d._prevBlock,h=e.cfg.segmentSize/32,i=0;i<f/h;i++){g?g=g.slice(h).concat(d._ct):(g=d._iv.slice(0),d._iv=void 0),c||(d._ct=a.slice(b+i*h,b+i*h+h));var j=g.slice(0);e.encryptBlock(j,0);for(var k=0;k<h;k++)a[b+i*h+k]^=j[k];c&&(d._ct=a.slice(b+i*h,b+i*h+h))}d._prevBlock=g}function b(a,b,c){var e,f,g,h=this,i=h._cipher,j=32*i.blockSize,k=h._prevBlock,n=i.cfg.segmentSize,o=[];for(e=31;e<n;e+=32)o.push(4294967295);for(o.push((1<<n)-1<<32-n),e=o.length;e<a.length;e++)o.push(0);o=new d.init(o);var p,q=o.clone(),r=q.clone();for(l(r,32*-b),e=0;e<j/n;e++){if(k){for(k=new d.init(k),l(k,n),k=k.words,previousCiphertextSegment=h._ct;previousCiphertextSegment.length<j/32;)previousCiphertextSegment.push(0);previousCiphertextSegment=new d.init(previousCiphertextSegment),l(previousCiphertextSegment,-j+n);for(var f=0;f<k.length;f++)k[f]|=previousCiphertextSegment.words[f]}else k=h._iv.slice(0),h._iv=void 0;g=32*b+e*n;var s=new d.init(a.slice(0));l(s,g),c||(h._ct=s.words.slice(0,Math.ceil(n/32)));var t=k.slice(0);for(i.encryptBlock(t,0),f=0;f<Math.ceil(n/32);f++)s.words[f]^=t[f];for(f=0;f<s.words.length;f++)s.words[f]&=o.words[f];for(c&&(h._ct=s.words.slice(0,Math.ceil(n/32))),p=m(r.clone()),f=0;f<a.length;f++)a[f]&=p.words[f];for(l(s,-g),f=0;f<a.length;f++)a[f]|=s.words[f];l(q,-n),l(r,-n)}h._prevBlock=k}var c=a.lib.Base,d=a.lib.WordArray,e=a.algo.AES,f=a.ext,g=a.pad.OneZeroPadding,h=a.algo.CMAC,i=a.algo.S2V=c.extend({init:function(a){this._blockSize=16,this._cmacAD=h.create(a),this._cmacPT=h.create(a),this.reset()},reset:function(){this._buffer=new d.init,this._cmacAD.reset(),this._cmacPT.reset(),this._d=this._cmacAD.finalize(f.const_Zero),this._empty=!0,this._ptStarted=!1},updateAAD:function(b){return this._ptStarted?this:b?("string"==typeof b&&(b=a.enc.Utf8.parse(b)),this._d=f.xor(f.dbl(this._d),this._cmacAD.finalize(b)),this._empty=!1,this):this},update:function(b){if(!b)return this;this._ptStarted=!0;var c=this._buffer,d=this._blockSize,e=d/4,g=this._cmacPT;for("string"==typeof b&&(b=a.enc.Utf8.parse(b)),c.concat(b);c.sigBytes>=2*d;){this._empty=!1;var h=f.popWords(c,e);g.update(h)}return this},finalize:function(a){this.update(a);var b=this._blockSize,c=this._buffer;if(this._empty&&0===c.sigBytes)return this._cmacAD.finalize(f.const_One);var d;return c.sigBytes>=b?d=f.xorendBytes(c,this._d):(g.pad(c,b),d=f.xor(f.dbl(this._d),c)),this._cmacPT.finalize(d)}}),j=(a.SIV=c.extend({init:function(a){var b=a.sigBytes/2;this._s2vKey=f.shiftBytes(a,b),this._ctrKey=a},encrypt:function(b,c){!c&&b&&(c=b,b=[]);var d=i.create(this._s2vKey);Array.prototype.forEach.call(b,function(a){d.updateAAD(a)});var e=d.finalize(c),g=f.bitand(e,f.const_nonMSB),h=a.AES.encrypt(c,this._ctrKey,{iv:g,mode:a.mode.CTR,padding:a.pad.NoPadding});return e.concat(h.ciphertext)},decrypt:function(b,c){!c&&b&&(c=b,b=[]);var d=f.shiftBytes(c,16),e=f.bitand(d,f.const_nonMSB),g=a.AES.decrypt({ciphertext:c},this._ctrKey,{iv:e,mode:a.mode.CTR,padding:a.pad.NoPadding}),h=i.create(this._s2vKey);Array.prototype.forEach.call(b,function(a){h.updateAAD(a)});var j=h.finalize(g);return!!f.equals(d,j)&&g}}),a.lib.BlockCipherMode.extend());j.Encryptor=j.extend({processBlock:function(a,c){b.call(this,a,c,!0)}}),j.Decryptor=j.extend({processBlock:function(a,c){b.call(this,a,c,!1)}}),a.mode.CFBw=j,a.enc.Bin={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++)for(var f=b[e>>>2]>>>24-e%4*8&255,g=7;g>=0;g--)d.push((f>>>g&1).toString(2));return d.join("")},parse:function(b){for(var c=[0],d=31,e=0,f=0;f<b.length;f++){var g=b[f];"0"!==g&&"1"!==g||(c[c.length-1]+=parseInt(g)<<d,d--,e++,d<0&&(d=31,c.push(0)))}return new a.lib.WordArray.init(c,Math.ceil(e/8))}};var f;f=a.hasOwnProperty("ext")?a.ext:a.ext={},f.bitshift=function(a,b){var c,d,e=0,f=a.words,g=0;if(b>0){for(;b>31;)f.splice(0,1),f.push(0),b-=32,g++;if(0==b)return e;for(var h=f.length-g-1;h>=0;h--)c=f[h],f[h]<<=b,f[h]|=e,e=c>>>32-b}else if(b<0){for(;b<-31;)f.splice(0,0,0),f.length--,b+=32,g++;if(0==b)return e;b=-b,d=(1<<b)-1;for(var h=g;h<f.length;h++)c=f[h]&d,f[h]>>>=b,f[h]|=e,e=c<<32-b}return e},f.neg=function(a){for(var b=a.words,c=0;c<b.length;c++)b[c]=~b[c];return a},f.xor=function(a,b){for(var c=0;c<a.words.length;c++)a.words[c]^=b.words[c];return a},f.bitand=function(a,b){for(var c=a.clone(),d=c.words,e=b.words,f=0;f<d.length;f++)d[f]&=e[f];return c};var k=a.lib.BlockCipherMode.extend(),d=a.lib.WordArray,l=a.ext.bitshift,m=a.ext.neg;k.Encryptor=k.extend({processBlock:function(a,c){b.call(this,a,c,!0)}}),k.Decryptor=k.extend({processBlock:function(a,c){b.call(this,a,c,!1)}}),a.mode.CFBb=k;var f;f=a.hasOwnProperty("ext")?a.ext:a.ext={};var c=a.lib.Base,d=a.lib.WordArray;f.const_Zero=new d.init([0,0,0,0]),f.const_One=new d.init([0,0,0,1]),f.const_Rb=new d.init([0,0,0,135]),f.const_Rb_Shifted=new d.init([2147483648,0,0,67]),f.const_nonMSB=new d.init([4294967295,4294967295,2147483647,2147483647]),f.isWordArray=function(a){return a&&"function"==typeof a.clamp&&"function"==typeof a.concat&&"array"==typeof a.words},a.pad.OneZeroPadding={pad:function(a,b){for(var c=4*b,e=c-a.sigBytes%c,f=[],g=0;g<e;g+=4){var h=0;0===g&&(h=2147483648),f.push(h)}var i=new d.init(f,e);a.concat(i)},unpad:function(){}},a.pad.NoPadding={pad:function(){},unpad:function(){}},f.leftmostBytes=function(a,b){var c=a.clone();return c.sigBytes=b,c.clamp(),c},f.rightmostBytes=function(a,b){a.clamp();var c=a.clone(),d=8*(c.sigBytes-b);if(d>=32){var e=Math.floor(d/32);d-=32*e,c.words.splice(0,e),c.sigBytes-=32*e/8}return d>0&&(f.bitshift(c,d),c.sigBytes-=d/8),c},f.popWords=function(a,b){var c=a.words.splice(0,b);return a.sigBytes-=4*b,new d.init(c)},f.shiftBytes=function(a,b){b=b||16;var c=b%4;b-=c;for(var e=new d.init,g=0;g<b;g+=4)e.words.push(a.words.shift()),a.sigBytes-=4,e.sigBytes+=4;return c>0&&(e.words.push(a.words[0]),e.sigBytes+=c,f.bitshift(a,8*c),a.sigBytes-=c),e},f.xorendBytes=function(a,b){return f.leftmostBytes(a,a.sigBytes-b.sigBytes).concat(f.xor(f.rightmostBytes(a,b.sigBytes),b))},f.dbl=function(a){var b=f.msb(a);return f.bitshift(a,1),f.xor(a,1===b?f.const_Rb:f.const_Zero),a},f.inv=function(a){var b=1&a.words[4];return f.bitshift(a,-1),f.xor(a,1===b?f.const_Rb_Shifted:f.const_Zero),a},f.equals=function(a,b){if(!b||!b.words||a.sigBytes!==b.sigBytes)return!1;a.clamp(),b.clamp();for(var c=0,d=0;d<a.words.length;d++)c|=a.words[d]^b.words[d];return 0===c},f.msb=function(a){return a.words[0]>>>31};var c=a.lib.Base,d=a.lib.WordArray,e=a.algo.AES,f=a.ext,g=a.pad.OneZeroPadding,h=a.algo.CMAC=c.extend({init:function(b){this._aes=e.createEncryptor(b,{iv:new d.init,padding:a.pad.NoPadding});var c=this._aes.finalize(f.const_Zero),g=c.clone();if(f.dbl(g),this._isTwo){var h=c.clone();f.inv(h)}else{var h=g.clone();f.dbl(h)}this._K1=g,this._K2=h,this._const_Bsize=16,this.reset()},reset:function(){this._x=f.const_Zero.clone(),this._counter=0,this._buffer=new d.init},update:function(b){if(!b)return this;var c=this._buffer,d=this._const_Bsize;for("string"==typeof b&&(b=a.enc.Utf8.parse(b)),c.concat(b);c.sigBytes>d;){var e=f.shiftBytes(c,d);f.xor(this._x,e),this._x.clamp(),this._aes.reset(),this._x=this._aes.finalize(this._x),this._counter++}return this},finalize:function(a){this.update(a);var b=this._buffer,c=this._const_Bsize,d=b.clone();return b.sigBytes===c?f.xor(d,this._K1):(g.pad(d,c/4),f.xor(d,this._K2)),f.xor(d,this._x),this.reset(),this._aes.reset(),this._aes.finalize(d)},_isTwo:!1});a.CMAC=function(a,b){return h.create(a).finalize(b)},a.algo.OMAC1=h,a.algo.OMAC2=h.extend({_isTwo:!0});var c=a.lib.Base,d=a.lib.WordArray,e=a.algo.AES,f=a.ext,h=a.algo.CMAC,n=new d.init([0,0,0,0]),o=new d.init([0,0,0,1]),p=new d.init([0,0,0,2]);a.EAX=c.extend({init:function(a,b){var c;if(b&&b.splitKey){var d=Math.floor(a.sigBytes/2);c=f.shiftBytes(a,d)}else c=a.clone();this._ctrKey=a,this._mac=h.create(c),this._tagLen=b&&b.tagLength||16,this.reset()},reset:function(){this._mac.update(o),this._ctr&&this._ctr.reset()},updateAAD:function(a){return this._mac.update(a),this},initCrypt:function(b,c){var g=this;return g._tag=g._mac.finalize(),g._isEnc=b,g._mac.update(n),c=g._mac.finalize(c),f.xor(g._tag,c),g._ctr=e.createEncryptor(g._ctrKey,{iv:c,mode:a.mode.CTR,padding:a.pad.NoPadding}),g._buf=new d.init,g._mac.update(p),g},update:function(b){"string"==typeof b&&(b=a.enc.Utf8.parse(b));var c=this,e=c._buf,g=c._isEnc;e.concat(b);var h=g?e.sigBytes:Math.max(e.sigBytes-c._tagLen,0),i=h>0?f.shiftBytes(e,h):new d.init,j=c._ctr.process(i);return c._mac.update(g?j:i),j},finalize:function(a){var b=this,c=a?b.update(a):new d.init,e=b._mac,g=b._ctr.finalize();if(b._isEnc){var h=e.finalize(g);return f.xor(b._tag,h),b.reset(),c.concat(g).concat(b._tag)}var h=e.finalize();return f.xor(b._tag,h),b.reset(),!!f.equals(b._tag,b._buf)&&c.concat(g)},encrypt:function(a,b,c){var d=this;return c&&Array.prototype.forEach.call(c,function(a){d.updateAAD(a)}),d.initCrypt(!0,b),d.finalize(a)},decrypt:function(a,b,c){var d=this;return c&&Array.prototype.forEach.call(c,function(a){d.updateAAD(a)}),d.initCrypt(!1,b),d.finalize(a)}})});