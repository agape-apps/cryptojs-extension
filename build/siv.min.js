/*
 * The MIT License
 *
 * (MIT)Copyright (c) 2015 artjomb
 */
!function(a,b,c){"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/aes","crypto-js/mode-ctr"],b):b(a.CryptoJS)}(this,function(a){var b;b=a.hasOwnProperty("ext")?a.ext:a.ext={},b.bitshift=function(a,b){var c,d,e=0,f=a.words,g=0;if(b>0){for(;b>31;)f.splice(0,1),f.push(0),b-=32,g++;if(0==b)return e;for(var h=f.length-g-1;h>=0;h--)c=f[h],f[h]<<=b,f[h]|=e,e=c>>>32-b}else if(b<0){for(;b<-31;)f.splice(0,0,0),f.length--,b+=32,g++;if(0==b)return e;b=-b,d=(1<<b)-1;for(var h=g;h<f.length;h++)c=f[h]&d,f[h]>>>=b,f[h]|=e,e=c<<32-b}return e},b.neg=function(a){for(var b=a.words,c=0;c<b.length;c++)b[c]=~b[c];return a},b.xor=function(a,b){for(var c=0;c<a.words.length;c++)a.words[c]^=b.words[c];return a},b.bitand=function(a,b){for(var c=a.clone(),d=c.words,e=b.words,f=0;f<d.length;f++)d[f]&=e[f];return c};var b;b=a.hasOwnProperty("ext")?a.ext:a.ext={};var c=a.lib.Base,d=a.lib.WordArray;b.const_Zero=new d.init([0,0,0,0]),b.const_One=new d.init([0,0,0,1]),b.const_Rb=new d.init([0,0,0,135]),b.const_Rb_Shifted=new d.init([2147483648,0,0,67]),b.const_nonMSB=new d.init([4294967295,4294967295,2147483647,2147483647]),b.isWordArray=function(a){return a&&"function"==typeof a.clamp&&"function"==typeof a.concat&&"array"==typeof a.words},a.pad.OneZeroPadding={pad:function(a,b){for(var c=4*b,e=c-a.sigBytes%c,f=[],g=0;g<e;g+=4){var h=0;0===g&&(h=2147483648),f.push(h)}var i=new d.init(f,e);a.concat(i)},unpad:function(){}},a.pad.NoPadding={pad:function(){},unpad:function(){}},b.leftmostBytes=function(a,b){var c=a.clone();return c.sigBytes=b,c.clamp(),c},b.rightmostBytes=function(a,c){a.clamp();var d=a.clone(),e=8*(d.sigBytes-c);if(e>=32){var f=Math.floor(e/32);e-=32*f,d.words.splice(0,f),d.sigBytes-=32*f/8}return e>0&&(b.bitshift(d,e),d.sigBytes-=e/8),d},b.popWords=function(a,b){var c=a.words.splice(0,b);return a.sigBytes-=4*b,new d.init(c)},b.shiftBytes=function(a,c){c=c||16;var e=c%4;c-=e;for(var f=new d.init,g=0;g<c;g+=4)f.words.push(a.words.shift()),a.sigBytes-=4,f.sigBytes+=4;return e>0&&(f.words.push(a.words[0]),f.sigBytes+=e,b.bitshift(a,8*e),a.sigBytes-=e),f},b.xorendBytes=function(a,c){return b.leftmostBytes(a,a.sigBytes-c.sigBytes).concat(b.xor(b.rightmostBytes(a,c.sigBytes),c))},b.dbl=function(a){var c=b.msb(a);return b.bitshift(a,1),b.xor(a,1===c?b.const_Rb:b.const_Zero),a},b.inv=function(a){var c=1&a.words[4];return b.bitshift(a,-1),b.xor(a,1===c?b.const_Rb_Shifted:b.const_Zero),a},b.equals=function(a,b){if(!b||!b.words||a.sigBytes!==b.sigBytes)return!1;a.clamp(),b.clamp();for(var c=0,d=0;d<a.words.length;d++)c|=a.words[d]^b.words[d];return 0===c},b.msb=function(a){return a.words[0]>>>31};var c=a.lib.Base,d=a.lib.WordArray,e=a.algo.AES,b=a.ext,f=a.pad.OneZeroPadding,g=a.algo.CMAC=c.extend({init:function(c){this._aes=e.createEncryptor(c,{iv:new d.init,padding:a.pad.NoPadding});var f=this._aes.finalize(b.const_Zero),g=f.clone();if(b.dbl(g),this._isTwo){var h=f.clone();b.inv(h)}else{var h=g.clone();b.dbl(h)}this._K1=g,this._K2=h,this._const_Bsize=16,this.reset()},reset:function(){this._x=b.const_Zero.clone(),this._counter=0,this._buffer=new d.init},update:function(c){if(!c)return this;var d=this._buffer,e=this._const_Bsize;for("string"==typeof c&&(c=a.enc.Utf8.parse(c)),d.concat(c);d.sigBytes>e;){var f=b.shiftBytes(d,e);b.xor(this._x,f),this._x.clamp(),this._aes.reset(),this._x=this._aes.finalize(this._x),this._counter++}return this},finalize:function(a){this.update(a);var c=this._buffer,d=this._const_Bsize,e=c.clone();return c.sigBytes===d?b.xor(e,this._K1):(f.pad(e,d/4),b.xor(e,this._K2)),b.xor(e,this._x),this.reset(),this._aes.reset(),this._aes.finalize(e)},_isTwo:!1});a.CMAC=function(a,b){return g.create(a).finalize(b)},a.algo.OMAC1=g,a.algo.OMAC2=g.extend({_isTwo:!0});var c=a.lib.Base,d=a.lib.WordArray,e=a.algo.AES,b=a.ext,f=a.pad.OneZeroPadding,g=a.algo.CMAC,h=a.algo.S2V=c.extend({init:function(a){this._blockSize=16,this._cmacAD=g.create(a),this._cmacPT=g.create(a),this.reset()},reset:function(){this._buffer=new d.init,this._cmacAD.reset(),this._cmacPT.reset(),this._d=this._cmacAD.finalize(b.const_Zero),this._empty=!0,this._ptStarted=!1},updateAAD:function(c){return this._ptStarted?this:c?("string"==typeof c&&(c=a.enc.Utf8.parse(c)),this._d=b.xor(b.dbl(this._d),this._cmacAD.finalize(c)),this._empty=!1,this):this},update:function(c){if(!c)return this;this._ptStarted=!0;var d=this._buffer,e=this._blockSize,f=e/4,g=this._cmacPT;for("string"==typeof c&&(c=a.enc.Utf8.parse(c)),d.concat(c);d.sigBytes>=2*e;){this._empty=!1;var h=b.popWords(d,f);g.update(h)}return this},finalize:function(a){this.update(a);var c=this._blockSize,d=this._buffer;if(this._empty&&0===d.sigBytes)return this._cmacAD.finalize(b.const_One);var e;return d.sigBytes>=c?e=b.xorendBytes(d,this._d):(f.pad(d,c),e=b.xor(b.dbl(this._d),d)),this._cmacPT.finalize(e)}});a.SIV=c.extend({init:function(a){var c=a.sigBytes/2;this._s2vKey=b.shiftBytes(a,c),this._ctrKey=a},encrypt:function(c,d){!d&&c&&(d=c,c=[]);var e=h.create(this._s2vKey);Array.prototype.forEach.call(c,function(a){e.updateAAD(a)});var f=e.finalize(d),g=b.bitand(f,b.const_nonMSB),i=a.AES.encrypt(d,this._ctrKey,{iv:g,mode:a.mode.CTR,padding:a.pad.NoPadding});return f.concat(i.ciphertext)},decrypt:function(c,d){!d&&c&&(d=c,c=[]);var e=b.shiftBytes(d,16),f=b.bitand(e,b.const_nonMSB),g=a.AES.decrypt({ciphertext:d},this._ctrKey,{iv:f,mode:a.mode.CTR,padding:a.pad.NoPadding}),i=h.create(this._s2vKey);Array.prototype.forEach.call(c,function(a){i.updateAAD(a)});var j=i.finalize(g);return!!b.equals(e,j)&&g}})});